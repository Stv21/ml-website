<!DOCTYPE html>
<html>
<head>
    <title>K-Means (database.sqlite)</title>
    <meta charset="UTF-8">
</head>
<body>
<pre>
import pandas as pd
import sqlite3  # <-- We need this library
from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import silhouette_score
from google.colab import drive

# 1. Mount Google Drive
drive.mount('/content/drive')

# --- IMPORTANT: Update this path to your file ---
db_path = "/content/drive/Shared with me/Ml datasets/k means/database.sqlite"

# 2. Load Data (from .sqlite database)
try:
    # --- This is the database-loading part ---
    con = sqlite3.connect(db_path) # Connect to the database file
    query = "SELECT * FROM Iris"   # Write a SQL query to select the table
    df = pd.read_sql_query(query, con) # Load query results into a DataFrame
    con.close() # Always close the connection
    # --- End of database-loading ---
except Exception as e:
    print(f"Error connecting or querying database: {e}")
    print("Make sure the file path is correct and the table name is 'Iris'.")
    exit()

print("Data loaded successfully from database.sqlite.")
print(df.head())

# 3. Prepare Data for Clustering
# The rest of the code is IDENTICAL to the .csv version
# We drop non-numeric columns and the 'Id' column.
try:
    X = df.drop(['Id', 'Species'], axis=1)
    y_true = df['Species'] # Keep the real answer for comparison
    feature_names = X.columns
except KeyError:
    print("Error: Could not find 'Id' or 'Species' columns.")
    X = df.iloc[:, 1:5] 
    y_true = df.iloc[:, -1]
    feature_names = X.columns

print("\nFeatures selected for clustering:")
print(feature_names)

# 4. Feature Scaling
# --- CRITICAL FOR K-MEANS ---
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# 5. Initialize and Train K-Means Model
k = 3
model = KMeans(n_clusters=k, n_init=10, random_state=42)
model.fit(X_scaled)

# 6. Get Results
cluster_labels = model.labels_
sil_score = silhouette_score(X_scaled, cluster_labels)
print(f"\nSilhouette Score (for k={k}): {sil_score:.4f}")

# 7. (Optional) Compare to True Labels
results = pd.DataFrame({'KMeans_Label': cluster_labels, 'True_Species': y_true})
print("\nComparison of K-Means Labels vs. True Species (first 10 rows):")
print(results.head(10))
</pre>
</body>
</html>
